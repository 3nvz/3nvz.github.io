<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Localhost Auto Embed Open Ports</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, Arial; margin: 0; background: #f7f7f7; }
    h1 { padding: 12px 18px; background: #222; color: #fff; margin: 0; }
    #status { padding: 10px 18px; color: #444; }
    iframe { width: 100%; height: 400px; border: 1px solid #ddd; margin-bottom: 20px; background: #fff; }
    .loading { opacity: 0.5; }
  </style>
</head>
<body>
  <h1>Localhost Open Port Viewer</h1>
  <div id="status">Scanning localhost ports...</div>
  <div id="container"></div>

<script>
(async () => {
  const HOST = '127.0.0.1';
  const TIMEOUT_MS = 900;
  const CONCURRENCY = 50;
  const PORTS = [
    80,443,445,631,1080,1433,1521,1883,2375,3000,
    3306,3389,5000,5432,5601,5900,6379,6380,6443,7000,
    8000,8080,8081,8088,8443,8500,8888,9000,9090,9200,
    9300,9999,11211,27017,50070,50075
  ];
  const status = document.getElementById('status');
  const container = document.getElementById('container');

  function withTimeout(promise, ms) {
    return Promise.race([
      promise,
      new Promise((_, reject) => setTimeout(() => reject(new Error('timeout')), ms))
    ]);
  }

  async function isOpen(port) {
    const url = `http://${HOST}:${port}/?check=${Math.random()}`;
    try {
      await withTimeout(fetch(url, { mode: 'no-cors', cache: 'no-store' }), TIMEOUT_MS);
      return true;
    } catch {
      return false;
    }
  }

  async function chunked(ports, concurrency) {
    const openPorts = [];
    for (let i = 0; i < ports.length; i += concurrency) {
      const batch = ports.slice(i, i + concurrency);
      const checks = await Promise.all(batch.map(async port => {
        const ok = await isOpen(port);
        if (ok) {
          openPorts.push(port);
          const frame = document.createElement('iframe');
          frame.src = `http://${HOST}:${port}/install`;
          frame.title = `Port ${port} (/install)`;
          container.appendChild(frame);
        }
      }));
      status.textContent = `Scanned ${Math.min(i + concurrency, ports.length)}/${ports.length} ports — found ${openPorts.length} open`;
      await new Promise(r => setTimeout(r, 50)); // keep UI responsive
    }
    return openPorts;
  }

  const found = await chunked(PORTS, CONCURRENCY);
  status.textContent = `✅ Done. Found ${found.length} open ports: ${found.join(', ')}`;
})();
</script>
</body>
</html>
